!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";chrome.webRequest.onBeforeSendHeaders.addListener((function(e){const t=e.requestHeaders;console.log("headers",t);const r=t.filter(e=>e.name.includes("X-Instaweb")).map(e=>({name:e.name.replace("X-Instaweb-",""),value:e.value}));return console.log("new headers",r),t.forEach(e=>{const t=r.find(t=>t.name==e.name);t&&(console.log(`changing header '${e.name}' to '${t.name}':`,e.value,t.value),e.value=t.value)}),console.log("edited headers",t),{requestHeaders:t}}),{urls:["https://caffeinum.github.io/*","https://instagrambot.github.io/*","https://dashboard.gramup.me/*","https://api.gramup.me/*","https://gramup.me/*","*://localhost/*","file://*/*","chrome-extension://*/*","*://*/*"],types:["main_frame","sub_frame","xmlhttprequest"]},["blocking","requestHeaders"]),chrome.runtime.onInstalled.addListener((async function(e){const{username:t,password:r}=await getCredentials();chrome.tabs.create({url:"popup.html"},(function(e){}))}));const API_URL="https://i.instagram.com/api/v1/",API_URL_v2="https://i.instagram.com/api/v2/",DEFAULT_DEVICE="one_plus_7",DEVICES={one_plus_7:{instagram_version:"103.1.0.15.119",android_version:28,android_release:"9.0",dpi:"420dpi",resolution:"1080x2260",manufacturer:"OnePlus",device:"GM1903",model:"OnePlus7",cpu:"qcom"},samsung_galaxy_s7:{instagram_version:"26.0.0.10.86",android_version:24,android_release:"7.0",dpi:"640dpi",resolution:"1440x2560",manufacturer:"samsung",device:"SM-G930F",model:"herolte",cpu:"samsungexynos8890"},huawei_mate_9_pro:{instagram_version:"26.0.0.10.86",android_version:24,android_release:"7.0",dpi:"640dpi",resolution:"1440x2560",manufacturer:"HUAWEI",device:"LON-L29",model:"HWLON",cpu:"hi3660"},samsung_galaxy_s9_plus:{instagram_version:"96.0.0.28.114",android_version:24,android_release:"7.0",dpi:"640dpi",resolution:"1440x2560",manufacturer:"samsung",device:"SM-G965F",model:"star2qltecs",cpu:"samsungexynos9810"},one_plus_3t:{instagram_version:"26.0.0.10.86",android_version:24,android_release:"7.0",dpi:"380dpi",resolution:"1080x1920",manufacturer:"OnePlus",device:"ONEPLUS A3010",model:"OnePlus3T",cpu:"qcom"},lg_g5:{instagram_version:"26.0.0.10.86",android_version:23,android_release:"6.0.1",dpi:"640dpi",resolution:"1440x2392",manufacturer:"LGE/lge",device:"RS988",model:"h1",cpu:"h1"},zte_axon_7:{instagram_version:"26.0.0.10.86",android_version:23,android_release:"6.0.1",dpi:"640dpi",resolution:"1440x2560",manufacturer:"ZTE",device:"ZTE A2017U",model:"ailsa_ii",cpu:"qcom"},samsung_galaxy_s7_edge:{instagram_version:"26.0.0.10.86",android_version:23,android_release:"6.0.1",dpi:"640dpi",resolution:"1440x2560",manufacturer:"samsung",device:"SM-G935",model:"hero2lte",cpu:"samsungexynos8890"}},DEVICE=DEVICES[DEFAULT_DEVICE],REQUEST_HEADERS={"X-IG-Capabilities":"3brTBw==","X-IG-Connection-Type":"WIFI","X-FB-HTTP-Engine":"Liger",Accept:"*/*","Accept-Language":"en-US","Content-type":"application/x-www-form-urlencoded; charset=UTF-8","Accept-Encoding":"gzip,deflate",Connection:"Keep-Alive",Cookie2:"$Version=1"},IG_SIG_KEY="f0bdfd5332d66a64d5e04965e6a7ade67c4e2cfc57ea38f0083c0400640a5e20",IG_VERSION="130.0.0.31.121",USER_AGENT_BASE=e=>`Instagram ${IG_VERSION} `+`Android (${e.android_version}/${e.android_release}; `+`${e.dpi}; ${e.resolution}; ${e.manufacturer}; `+`${e.device}; ${e.model}; ${e.cpu}; en_US)`;var bind=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},isBuffer=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},toString=Object.prototype.toString;
/*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   */function isArray(e){return"[object Array]"===toString.call(e)}function isArrayBuffer(e){return"[object ArrayBuffer]"===toString.call(e)}function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData}function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isObject(e){return null!==e&&"object"==typeof e}function isDate(e){return"[object Date]"===toString.call(e)}function isFile(e){return"[object File]"===toString.call(e)}function isBlob(e){return"[object Blob]"===toString.call(e)}function isFunction(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function trim(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function merge(){var e={};function t(t,r){"object"==typeof e[r]&&"object"==typeof t?e[r]=merge(e[r],t):e[r]=t}for(var r=0,n=arguments.length;r<n;r++)forEach(arguments[r],t);return e}function extend(e,t,r){return forEach(t,(function(t,n){e[n]=r&&"function"==typeof t?bind(t,r):t})),e}var utils={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim},global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$1.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var browser$1={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},normalizeHeaderName=function(e,t){utils.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},enhanceError=function(e,t,r,n,o){return e.config=t,r&&(e.code=r),e.request=n,e.response=o,e},createError=function(e,t,r,n,o){var s=new Error(e);return enhanceError(s,t,r,n,o)},settle=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(createError("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)};function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(utils.isURLSearchParams(t))n=t.toString();else{var o=[];utils.forEach(t,(function(e,t){null!=e&&(utils.isArray(e)?t+="[]":e=[e],utils.forEach(e,(function(e){utils.isDate(e)?e=e.toISOString():utils.isObject(e)&&(e=JSON.stringify(e)),o.push(encode(t)+"="+encode(e))})))})),n=o.join("&")}return n&&(e+=(-1===e.indexOf("?")?"?":"&")+n),e},ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders=function(e){var t,r,n,o={};return e?(utils.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=utils.trim(e.substr(0,n)).toLowerCase(),r=utils.trim(e.substr(n+1)),t){if(o[t]&&ignoreDuplicateOf.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o},isURLSameOrigin=utils.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=utils.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0},cookies=utils.isStandardBrowserEnv()?{write:function(e,t,r,n,o,s){var i=[];i.push(e+"="+encodeURIComponent(t)),utils.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),utils.isString(n)&&i.push("path="+n),utils.isString(o)&&i.push("domain="+o),!0===s&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},xhr=function(e){return new Promise((function(t,r){var n=e.data,o=e.headers;utils.isFormData(n)&&delete o["Content-Type"];var s=new XMLHttpRequest;if(e.auth){var i=e.auth.username||"",a=e.auth.password||"";o.Authorization="Basic "+btoa(i+":"+a)}if(s.open(e.method.toUpperCase(),buildURL(e.url,e.params,e.paramsSerializer),!0),s.timeout=e.timeout,s.onreadystatechange=function(){if(s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in s?parseHeaders(s.getAllResponseHeaders()):null,o={data:e.responseType&&"text"!==e.responseType?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:n,config:e,request:s};settle(t,r,o),s=null}},s.onerror=function(){r(createError("Network Error",e,null,s)),s=null},s.ontimeout=function(){r(createError("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",s)),s=null},utils.isStandardBrowserEnv()){var u=cookies,c=(e.withCredentials||isURLSameOrigin(e.url))&&e.xsrfCookieName?u.read(e.xsrfCookieName):void 0;c&&(o[e.xsrfHeaderName]=c)}if("setRequestHeader"in s&&utils.forEach(o,(function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete o[t]:s.setRequestHeader(t,e)})),e.withCredentials&&(s.withCredentials=!0),e.responseType)try{s.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&s.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){s&&(s.abort(),r(e),s=null)})),void 0===n&&(n=null),s.send(n)}))},DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils.isUndefined(e)&&utils.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||void 0!==browser$1)&&(e=xhr),e}var defaults={adapter:getDefaultAdapter(),transformRequest:[function(e,t){return normalizeHeaderName(t,"Content-Type"),utils.isFormData(e)||utils.isArrayBuffer(e)||utils.isBuffer(e)||utils.isStream(e)||utils.isFile(e)||utils.isBlob(e)?e:utils.isArrayBufferView(e)?e.buffer:utils.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):utils.isObject(e)?(setContentTypeIfUnset(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],(function(e){defaults.headers[e]={}})),utils.forEach(["post","put","patch"],(function(e){defaults.headers[e]=utils.merge(DEFAULT_CONTENT_TYPE)}));var defaults_1=defaults;function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},InterceptorManager.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function(e){utils.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1=InterceptorManager,transformData=function(e,t,r){return utils.forEach(r,(function(r){e=r(e,t)})),e},isCancel=function(e){return!(!e||!e.__CANCEL__)},isAbsoluteURL=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},combineURLs=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e};function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var dispatchRequest=function(e){return throwIfCancellationRequested(e),e.baseURL&&!isAbsoluteURL(e.url)&&(e.url=combineURLs(e.baseURL,e.url)),e.headers=e.headers||{},e.data=transformData(e.data,e.headers,e.transformRequest),e.headers=utils.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),utils.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults_1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData(t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))};function Axios(e){this.defaults=e,this.interceptors={request:new InterceptorManager_1,response:new InterceptorManager_1}}Axios.prototype.request=function(e){"string"==typeof e&&(e=utils.merge({url:arguments[0]},arguments[1])),(e=utils.merge(defaults_1,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[dispatchRequest,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r},utils.forEach(["delete","get","head","options"],(function(e){Axios.prototype[e]=function(t,r){return this.request(utils.merge(r||{},{method:e,url:t}))}})),utils.forEach(["post","put","patch"],(function(e){Axios.prototype[e]=function(t,r,n){return this.request(utils.merge(n||{},{method:e,url:t,data:r}))}}));var Axios_1=Axios;function Cancel(e){this.message=e}Cancel.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0;var Cancel_1=Cancel;function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new Cancel_1(e),t(r.reason))}))}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken.source=function(){var e;return{token:new CancelToken((function(t){e=t})),cancel:e}};var CancelToken_1=CancelToken,spread=function(e){return function(t){return e.apply(null,t)}};function createInstance(e){var t=new Axios_1(e),r=bind(Axios_1.prototype.request,t);return utils.extend(r,Axios_1.prototype,t),utils.extend(r,t),r}var axios=createInstance(defaults_1);axios.Axios=Axios_1,axios.create=function(e){return createInstance(utils.merge(defaults_1,e))},axios.Cancel=Cancel_1,axios.CancelToken=CancelToken_1,axios.isCancel=isCancel,axios.all=function(e){return Promise.all(e)},axios.spread=spread;var axios_1=axios,default_1=axios;axios_1.default=default_1;var axios$1=axios_1,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var md5=createCommonjsModule((function(e){!function(t){function r(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,n,o,s,i){return r((a=r(r(t,e),r(o,i)))<<(u=s)|a>>>32-u,n);var a,u}function o(e,t,r,o,s,i,a){return n(t&r|~t&o,e,t,s,i,a)}function s(e,t,r,o,s,i,a){return n(t&o|r&~o,e,t,s,i,a)}function i(e,t,r,o,s,i,a){return n(t^r^o,e,t,s,i,a)}function a(e,t,r,o,s,i,a){return n(r^(t|~o),e,t,s,i,a)}function u(e,t){var n,u,c,l,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,f=-271733879,_=-1732584194,m=271733878;for(n=0;n<e.length;n+=16)u=h,c=f,l=_,d=m,h=o(h,f,_,m,e[n],7,-680876936),m=o(m,h,f,_,e[n+1],12,-389564586),_=o(_,m,h,f,e[n+2],17,606105819),f=o(f,_,m,h,e[n+3],22,-1044525330),h=o(h,f,_,m,e[n+4],7,-176418897),m=o(m,h,f,_,e[n+5],12,1200080426),_=o(_,m,h,f,e[n+6],17,-1473231341),f=o(f,_,m,h,e[n+7],22,-45705983),h=o(h,f,_,m,e[n+8],7,1770035416),m=o(m,h,f,_,e[n+9],12,-1958414417),_=o(_,m,h,f,e[n+10],17,-42063),f=o(f,_,m,h,e[n+11],22,-1990404162),h=o(h,f,_,m,e[n+12],7,1804603682),m=o(m,h,f,_,e[n+13],12,-40341101),_=o(_,m,h,f,e[n+14],17,-1502002290),h=s(h,f=o(f,_,m,h,e[n+15],22,1236535329),_,m,e[n+1],5,-165796510),m=s(m,h,f,_,e[n+6],9,-1069501632),_=s(_,m,h,f,e[n+11],14,643717713),f=s(f,_,m,h,e[n],20,-373897302),h=s(h,f,_,m,e[n+5],5,-701558691),m=s(m,h,f,_,e[n+10],9,38016083),_=s(_,m,h,f,e[n+15],14,-660478335),f=s(f,_,m,h,e[n+4],20,-405537848),h=s(h,f,_,m,e[n+9],5,568446438),m=s(m,h,f,_,e[n+14],9,-1019803690),_=s(_,m,h,f,e[n+3],14,-187363961),f=s(f,_,m,h,e[n+8],20,1163531501),h=s(h,f,_,m,e[n+13],5,-1444681467),m=s(m,h,f,_,e[n+2],9,-51403784),_=s(_,m,h,f,e[n+7],14,1735328473),h=i(h,f=s(f,_,m,h,e[n+12],20,-1926607734),_,m,e[n+5],4,-378558),m=i(m,h,f,_,e[n+8],11,-2022574463),_=i(_,m,h,f,e[n+11],16,1839030562),f=i(f,_,m,h,e[n+14],23,-35309556),h=i(h,f,_,m,e[n+1],4,-1530992060),m=i(m,h,f,_,e[n+4],11,1272893353),_=i(_,m,h,f,e[n+7],16,-155497632),f=i(f,_,m,h,e[n+10],23,-1094730640),h=i(h,f,_,m,e[n+13],4,681279174),m=i(m,h,f,_,e[n],11,-358537222),_=i(_,m,h,f,e[n+3],16,-722521979),f=i(f,_,m,h,e[n+6],23,76029189),h=i(h,f,_,m,e[n+9],4,-640364487),m=i(m,h,f,_,e[n+12],11,-421815835),_=i(_,m,h,f,e[n+15],16,530742520),h=a(h,f=i(f,_,m,h,e[n+2],23,-995338651),_,m,e[n],6,-198630844),m=a(m,h,f,_,e[n+7],10,1126891415),_=a(_,m,h,f,e[n+14],15,-1416354905),f=a(f,_,m,h,e[n+5],21,-57434055),h=a(h,f,_,m,e[n+12],6,1700485571),m=a(m,h,f,_,e[n+3],10,-1894986606),_=a(_,m,h,f,e[n+10],15,-1051523),f=a(f,_,m,h,e[n+1],21,-2054922799),h=a(h,f,_,m,e[n+8],6,1873313359),m=a(m,h,f,_,e[n+15],10,-30611744),_=a(_,m,h,f,e[n+6],15,-1560198380),f=a(f,_,m,h,e[n+13],21,1309151649),h=a(h,f,_,m,e[n+4],6,-145523070),m=a(m,h,f,_,e[n+11],10,-1120210379),_=a(_,m,h,f,e[n+2],15,718787259),f=a(f,_,m,h,e[n+9],21,-343485551),h=r(h,u),f=r(f,c),_=r(_,l),m=r(m,d);return[h,f,_,m]}function c(e){var t,r="",n=32*e.length;for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function l(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function d(e){var t,r,n="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function h(e){return unescape(encodeURIComponent(e))}function f(e){return function(e){return c(u(l(e),8*e.length))}(h(e))}function _(e,t){return function(e,t){var r,n,o=l(e),s=[],i=[];for(s[15]=i[15]=void 0,o.length>16&&(o=u(o,8*e.length)),r=0;r<16;r+=1)s[r]=909522486^o[r],i[r]=1549556828^o[r];return n=u(s.concat(l(t)),512+8*t.length),c(u(i.concat(n),640))}(h(e),h(t))}function m(e,t,r){return t?r?_(t,e):d(_(t,e)):r?f(e):d(f(e))}e.exports?e.exports=m:t.md5=m}(commonjsGlobal)})),sha256=createCommonjsModule((function(module){
/**
   * [js-sha256]{@link https://github.com/emn178/js-sha256}
   *
   * @version 0.9.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   */
!function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof browser$1&&browser$1.versions&&browser$1.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(r){return new Sha256(t,!0).update(r)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<OUTPUT_TYPES.length;++r){var n=OUTPUT_TYPES[r];t[n]=createOutputMethod(n,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(r,n){return new HmacSha256(r,t,!0).update(n)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<OUTPUT_TYPES.length;++r){var n=OUTPUT_TYPES[r];t[n]=createHmacOutputMethod(n,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,r){var n,o=typeof e;if("string"===o){var s,i=[],a=e.length,u=0;for(n=0;n<a;++n)(s=e.charCodeAt(n))<128?i[u++]=s:s<2048?(i[u++]=192|s>>6,i[u++]=128|63&s):s<55296||s>=57344?(i[u++]=224|s>>12,i[u++]=128|s>>6&63,i[u++]=128|63&s):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++n)),i[u++]=240|s>>18,i[u++]=128|s>>12&63,i[u++]=128|s>>6&63,i[u++]=128|63&s);e=i}else{if("object"!==o)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var c=[],l=[];for(n=0;n<64;++n){var d=e[n]||0;c[n]=92^d,l[n]=54^d}Sha256.call(this,t,r),this.update(l),this.oKeyPad=c,this.inner=!0,this.sharedMemory=r}Sha256.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"!==r)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var n,o,s=0,i=e.length,a=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(o=this.start;s<i&&o<64;++s)a[o>>2]|=e[s]<<SHIFT[3&o++];else for(o=this.start;s<i&&o<64;++s)(n=e.charCodeAt(s))<128?a[o>>2]|=n<<SHIFT[3&o++]:n<2048?(a[o>>2]|=(192|n>>6)<<SHIFT[3&o++],a[o>>2]|=(128|63&n)<<SHIFT[3&o++]):n<55296||n>=57344?(a[o>>2]|=(224|n>>12)<<SHIFT[3&o++],a[o>>2]|=(128|n>>6&63)<<SHIFT[3&o++],a[o>>2]|=(128|63&n)<<SHIFT[3&o++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),a[o>>2]|=(240|n>>18)<<SHIFT[3&o++],a[o>>2]|=(128|n>>12&63)<<SHIFT[3&o++],a[o>>2]|=(128|n>>6&63)<<SHIFT[3&o++],a[o>>2]|=(128|63&n)<<SHIFT[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.block=a[16],this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,r,n,o,s,i,a,u,c=this.h0,l=this.h1,d=this.h2,h=this.h3,f=this.h4,_=this.h5,m=this.h6,g=this.h7,p=this.blocks;for(e=16;e<64;++e)t=((o=p[e-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,r=((o=p[e-2])>>>17|o<<15)^(o>>>19|o<<13)^o>>>10,p[e]=p[e-16]+t+p[e-7]+r<<0;for(u=l&d,e=0;e<64;e+=4)this.first?(this.is224?(s=300032,g=(o=p[0]-1413257819)-150054599<<0,h=o+24177077<<0):(s=704751109,g=(o=p[0]-210244248)-1521486534<<0,h=o+143694565<<0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),n=(s=c&l)^c&d^u,g=h+(o=g+(r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&_^~f&m)+K[e]+p[e])<<0,h=o+(t+n)<<0),t=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),n=(i=h&c)^h&l^s,m=d+(o=m+(r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&f^~g&_)+K[e+1]+p[e+1])<<0,t=((d=o+(t+n)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),n=(a=d&h)^d&c^i,_=l+(o=_+(r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&g^~m&f)+K[e+2]+p[e+2])<<0,t=((l=o+(t+n)<<0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),n=(u=l&d)^l&h^a,f=c+(o=f+(r=(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&m^~_&g)+K[e+3]+p[e+3])<<0,c=o+(t+n)<<0;this.h0=this.h0+c<<0,this.h1=this.h1+l<<0,this.h2=this.h2+d<<0,this.h3=this.h3+h<<0,this.h4=this.h4+f<<0,this.h5=this.h5+_<<0,this.h6=this.h6+m<<0,this.h7=this.h7+g<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,o=this.h4,s=this.h5,i=this.h6,a=this.h7,u=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i];return this.is224||(u+=HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]),u},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,o=this.h4,s=this.h5,i=this.h6,a=this.h7,u=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,o>>24&255,o>>16&255,o>>8&255,255&o,s>>24&255,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i];return this.is224||u.push(a>>24&255,a>>16&255,a>>8&255,255&a),u},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224)}()}));function UUIDjs(){}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}UUIDjs.maxFromBits=function(e){return Math.pow(2,e)},UUIDjs.limitUI04=UUIDjs.maxFromBits(4),UUIDjs.limitUI06=UUIDjs.maxFromBits(6),UUIDjs.limitUI08=UUIDjs.maxFromBits(8),UUIDjs.limitUI12=UUIDjs.maxFromBits(12),UUIDjs.limitUI14=UUIDjs.maxFromBits(14),UUIDjs.limitUI16=UUIDjs.maxFromBits(16),UUIDjs.limitUI32=UUIDjs.maxFromBits(32),UUIDjs.limitUI40=UUIDjs.maxFromBits(40),UUIDjs.limitUI48=UUIDjs.maxFromBits(48),UUIDjs.randomUI04=function(){return getRandomInt(0,UUIDjs.limitUI04-1)},UUIDjs.randomUI06=function(){return getRandomInt(0,UUIDjs.limitUI06-1)},UUIDjs.randomUI08=function(){return getRandomInt(0,UUIDjs.limitUI08-1)},UUIDjs.randomUI12=function(){return getRandomInt(0,UUIDjs.limitUI12-1)},UUIDjs.randomUI14=function(){return getRandomInt(0,UUIDjs.limitUI14-1)},UUIDjs.randomUI16=function(){return getRandomInt(0,UUIDjs.limitUI16-1)},UUIDjs.randomUI32=function(){return getRandomInt(0,UUIDjs.limitUI32-1)},UUIDjs.randomUI40=function(){return(0|Math.random()*(1<<30))+(0|1024*Math.random())*(1<<30)},UUIDjs.randomUI48=function(){return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<18))*(1<<30)},UUIDjs.paddedString=function(e,t,r){r=r||"0";for(var n=t-(e=String(e)).length;n>0;n>>>=1,r+=r)1&n&&(e=r+e);return e},UUIDjs.prototype.fromParts=function(e,t,r,n,o,s){return this.version=r>>12&15,this.hex=UUIDjs.paddedString(e.toString(16),8)+"-"+UUIDjs.paddedString(t.toString(16),4)+"-"+UUIDjs.paddedString(r.toString(16),4)+"-"+UUIDjs.paddedString(n.toString(16),2)+UUIDjs.paddedString(o.toString(16),2)+"-"+UUIDjs.paddedString(s.toString(16),12),this},UUIDjs.prototype.toString=function(){return this.hex},UUIDjs.prototype.toURN=function(){return"urn:uuid:"+this.hex},UUIDjs.prototype.toBytes=function(){for(var e=this.hex.split("-"),t=[],r=0,n=0;n<e.length;n++)for(var o=0;o<e[n].length;o+=2)t[r++]=parseInt(e[n].substr(o,2),16);return t},UUIDjs.prototype.equals=function(e){return e instanceof UUID&&this.hex===e.hex},UUIDjs.getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),r=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&r,hi:r>>>16,timestamp:t}},UUIDjs._create4=function(){return(new UUIDjs).fromParts(UUIDjs.randomUI32(),UUIDjs.randomUI16(),16384|UUIDjs.randomUI12(),128|UUIDjs.randomUI06(),UUIDjs.randomUI08(),UUIDjs.randomUI48())},UUIDjs._create1=function(){var e=(new Date).getTime(),t=UUIDjs.randomUI14(),r=1099511627776*(1|UUIDjs.randomUI08())+UUIDjs.randomUI40(),n=UUIDjs.randomUI04(),o=0;e!=o?(e<o&&t++,o=e,n=UUIDjs.randomUI04()):Math.random()<.25&&n<9984?n+=1+UUIDjs.randomUI04():t++;var s=UUIDjs.getTimeFieldValues(o),i=s.low+n,a=4095&s.hi|4096,u=(t&=16383)>>>8|128,c=255&t;return(new UUIDjs).fromParts(i,s.mid,a,u,c,r)},UUIDjs.create=function(e){return this["_create"+(e=e||4)]()},UUIDjs.fromTime=function(e,t){t=t||!1;var r=UUIDjs.getTimeFieldValues(e),n=r.low,o=4095&r.hi|4096;return!1===t?(new UUIDjs).fromParts(n,r.mid,o,0,0,0):(new UUIDjs).fromParts(n,r.mid,o,128|UUIDjs.limitUI06,UUIDjs.limitUI08-1,UUIDjs.limitUI48-1)},UUIDjs.firstFromTime=function(e){return UUIDjs.fromTime(e,!1)},UUIDjs.lastFromTime=function(e){return UUIDjs.fromTime(e,!0)},UUIDjs.fromURN=function(e){var t;return(t=/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i.exec(e))?(new UUIDjs).fromParts(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16)):null},UUIDjs.fromBytes=function(e){if(e.length<5)return null;for(var t="",r=0,n=[4,2,2,2,6],o=0;o<n.length;o++){for(var s=0;s<n[o];s++){var i=e[r++].toString(16);1==i.length&&(i="0"+i),t+=i}6!==n[o]&&(t+="-")}return UUIDjs.fromURN(t)},UUIDjs.fromBinary=function(e){for(var t=[],r=0;r<e.length;r++)if(t[r]=e.charCodeAt(r),t[r]>255||t[r]<0)throw new Error("Unexpected byte in binary data.");return UUIDjs.fromBytes(t)},UUIDjs.new=function(){return this.create(4)},UUIDjs.newTS=function(){return this.create(1)};var uuid=UUIDjs;const generate_uuid=()=>uuid.create(4).hex,generate_device_id=e=>`android-${md5(e+"12345").slice(0,16)}`,generate_device_id_from_username=e=>generate_device_id(md5(`${e}${e}`)),generate_signature=e=>("string"==typeof e||e instanceof String||(e=JSON.stringify(e)),`ig_sig_key_version=4&signed_body=${sha256.hmac(IG_SIG_KEY,e)+"."+encodeURIComponent(e)}`),random_from=e=>e[Math.floor(Math.random()*e.length)];function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var isArray$1=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function stringifyPrimitive(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function stringify(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?map(objectKeys(e),(function(n){var o=encodeURIComponent(stringifyPrimitive(n))+r;return isArray$1(e[n])?map(e[n],(function(e){return o+encodeURIComponent(stringifyPrimitive(e))})).join(t):o+encodeURIComponent(stringifyPrimitive(e[n]))})).join(t):n?encodeURIComponent(stringifyPrimitive(n))+r+encodeURIComponent(stringifyPrimitive(e)):""}function map(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var objectKeys=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function parse(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var a=e.length;i>0&&a>i&&(a=i);for(var u=0;u<a;++u){var c,l,d,h,f=e[u].replace(s,"%20"),_=f.indexOf(r);_>=0?(c=f.substr(0,_),l=f.substr(_+1)):(c=f,l=""),d=decodeURIComponent(c),h=decodeURIComponent(l),hasOwnProperty(o,d)?isArray$1(o[d])?o[d].push(h):o[d]=[o[d],h]:o[d]=h}return o}var querystring={encode:stringify,stringify:stringify,decode:parse,parse:parse};function is_user_id(e){return!isNaN(e)}const get_user_info=(e,t)=>{if(is_user_id(t)){const r=t;return e.send_request(`users/${r}/info/`)}{const r=t;return e.send_request(`users/${r}/usernameinfo/`)}},logout=async e=>{if(!e.is_logged_in)return!0;const t=await e.send_request("accounts/logout/");return e.is_logged_in=!t,t},get_user_followers=(e,t,r="",n="")=>{const o=e.rank_token(),s=`friendships/${t}/followers/?${querystring.stringify({max_id:n,rank_token:o,query:r})}`;return e.send_request(s)},get_user_followings=(e,t,r="",n="")=>{const o=e.rank_token(),s=`friendships/${t}/following/?${querystring.stringify({max_id:n,rank_token:o,query:r})}`;return e.send_request(s)},get_user_feed=(e,t,r="")=>{const n=`feed/user/${t}/?max_id=${r}&rank_token=${e.rank_token()}&ranked_content=true&`;return e.send_request(n)},get_hashtag_feed=(e,t,r="")=>{const n=`feed/tag/${t}/?max_id=${r}&rank_token=${e.rank_token()}&ranked_content=true&`;return e.send_request(n)},get_location_feed=(e,t,r="")=>{const n=`feed/location/${t}/?max_id=${r}&rank_token=${e.rank_token()}&ranked_content=true&`;return e.send_request(n)},media_info=(e,t)=>e.send_request(`media/${t}/info/`),like=(e,t)=>e.send_request(`media/${t}/like/`,{}),unlike=(e,t)=>e.send_request(`media/${t}/unlike/`,{}),follow=(e,t)=>e.send_request(`friendships/create/${t}/`,{}),unfollow=(e,t)=>e.send_request(`friendships/destroy/${t}/`,{}),user_friendship=(e,t)=>e.send_request(`friendships/show/${t}/`,{user_id:t}),user_friendships=async(e,t=[])=>{const r={user_ids:t.join(",")},n={...await e.default_data(),...r};return e.send_request("friendships/show_many/",n,{with_signature:!1,form:!0})},comment=(e,t,r)=>e.send_request(`media/${t}/comment/`,{comment_text:r}),reply_to_comment=(e,t,r,n)=>e.send_request(`media/${t}/comment/`,{comment_text:r,replied_to_comment_id:n}),delete_comment=(e,t,r)=>e.send_request(`media/${t}/comment/${r}/delete/`,{}),get_user_story_feed=(e,t)=>e.send_request(`feed/user/${t}/story/`),search_location=(e,t,r="",n="")=>{const o=e.rank_token();return e.send_request(`fbsearch/places/?rank_token=${o}&query=${t}&lat=${r}&lng=${n}`)},__DEPRECATED__get_timeline=e=>e.send_request(`feed/timeline/?rank_token=${e.rank_token()}&ranked_content=true`),get_timeline=e=>e.send_request("feed/timeline/",{is_prefetch:"0",is_pull_to_refresh:"0"},{with_signature:!1}),get_popular_feed=e=>e.send_request(`feed/popular/?people_teaser_supported=1&rank_token=${e.rank_token()}&ranked_content=true`),get_comment_likers=(e,t)=>e.send_request(`media/${t}/comment_likers`),get_media_likers=(e,t)=>e.send_request(`media/${t}/likers`),get_inbox=e=>e.send_request("direct_v2/inbox/?"),get_thread=(e,t,r="")=>e.send_request(`direct_v2/threads/${t}/?use_unified_inbox=true&${r?`cursor=${r}`:""}`),get_direct_share=e=>e.send_request("direct_share/inbox/?"),get_pending_inbox=e=>e.send_request("direct_v2/pending_inbox/?persistentBadging=true&use_unified_inbox=true"),approve_pending_thread=async(e,t)=>{const r=await e.default_data();return e.send_request(`direct_v2/threads/${t}/approve/`,r)},_prepare_recipients=(e,t=null,r=!1)=>{const n={};return e&&e.join&&(n.users=`[[${e.join(",")}]]`),t&&(n.thread=r?`["${t}"]`:`[${t}]`),n},send_direct_item=async(e,t="text",r={})=>{const n={client_context:generate_uuid(),action:"send_item"},o=r.text||"";"link"==t?(n.link_text=o,n.link_urls=JSON.stringify(r.urls)):"text"==t?n.text=o:"media_share"==t?(n.text=o,n.media_type=r.media_type||"photo",n.media_id=r.media_id||""):"hashtag"==t?(n.text=o,n.Hashtag=r.hashtag||""):"profile"==t&&(n.text=o,n.profile_user_id=r.profile_user_id||"");const{thread:s,users:i}=_prepare_recipients(r.users,r.thread,!1);if(s)n.thread_ids=s;else{if(!i)return!1;n.recipient_users=i}const a={...await e.default_data(),...n};return console.log("_data",a),e.send_request(`direct_v2/threads/broadcast/${t}/`,a,{with_signature:!1,form:!0})},mark_direct_seen=async(e,t,r)=>{const n={action:"mark_seen",use_unified_inbox:!0,thread_id:t,item_id:r},o={...await e.default_data(),...n};return e.send_request(`direct_v2/threads/${t}/items/${r}/seen/`,o,{with_signature:!1,form:!0})},get_user_reel=(e,t)=>{const r=`feed/user/${t}/reel_media/`;return e.send_request(r)},get_users_reel=async(e,t)=>(t=t.map(e=>`${e}`),e.send_request("feed/reels_media/",{user_ids:t})),see_reels=async(e,t=[])=>{t&&!t.join&&(t=[t]);const r={},n=Math.floor(Date.now()/1e3);t.sort((e,t)=>e.taken_at-t.taken_at).forEach((e,t)=>{const o=n-Math.min(t+1+(s=0,i=2,Math.floor(s+(i-s)*Math.random())),Math.max(0,n-e.taken_at));var s,i;r[`${e.id}_${e.user.pk}`]=[`${e.taken_at}_${o}`]});const o={...await e.default_data(),reels:r};return e.send_request("media/seen/",o,{with_signature:!0,v2:!0})},get_user_stories=(e,t)=>{const r=`feed/user/${t}/story/`;return e.send_request(r)},get_self_story_viewers=(e,t)=>{const r=`media/${t}/list_reel_media_viewer/?supported_capabilities_new=${{}.SUPPORTED_CAPABILITIES}`;return e.send_request(r)},get_tv_suggestions=e=>e.send_request("igtv/tv_guide/"),get_hashtag_stories=(e,t)=>{const r=`tags/${t}/story/`;return e.send_request(r)},report=async(e,t,r="profile")=>{const n={...await e.default_data(),reason_id:1,user_id:t,source_name:r,is_spam:!0};return e.send_request(`users/${t}/flag_user/`,n,{with_signature:!1,form:!0})};var methods=Object.freeze({__proto__:null,get_user_info:get_user_info,logout:logout,get_user_followers:get_user_followers,get_user_followings:get_user_followings,get_user_feed:get_user_feed,get_hashtag_feed:get_hashtag_feed,get_location_feed:get_location_feed,media_info:media_info,like:like,unlike:unlike,follow:follow,unfollow:unfollow,user_friendship:user_friendship,user_friendships:user_friendships,comment:comment,reply_to_comment:reply_to_comment,delete_comment:delete_comment,get_user_story_feed:get_user_story_feed,search_location:search_location,__DEPRECATED__get_timeline:__DEPRECATED__get_timeline,get_timeline:get_timeline,get_popular_feed:get_popular_feed,get_comment_likers:get_comment_likers,get_media_likers:get_media_likers,get_inbox:get_inbox,get_thread:get_thread,get_direct_share:get_direct_share,get_pending_inbox:get_pending_inbox,approve_pending_thread:approve_pending_thread,send_direct_item:send_direct_item,mark_direct_seen:mark_direct_seen,get_user_reel:get_user_reel,get_users_reel:get_users_reel,see_reels:see_reels,get_user_stories:get_user_stories,get_self_story_viewers:get_self_story_viewers,get_tv_suggestions:get_tv_suggestions,get_hashtag_stories:get_hashtag_stories,report:report});const FORBIDDEN_HEADERS=["Accept-Encoding","Connection","Cookie2","User-Agent"],PREFIX="X-Instaweb-",prefixUnsecureHeaders=(e,t)=>{for(const r in e)if(FORBIDDEN_HEADERS.includes(r)){e[PREFIX+r]=e[r],"replace"===t&&delete e[r]}return e},get_locale=()=>{try{return window.navigator.languages?window.navigator.languages[0]:window.navigator.userLanguage||window.navigator.language}catch(e){return console.error(e),null}},print=console.log;class Instagram{constructor(e,t){this.is_logged_in=!1,this.user_id=null,this.user=null,this.history=null,this.confirmator=null,this.locale=get_locale(),this.device=random_from(Object.values(DEVICES))||DEVICE,this.user_agent=USER_AGENT_BASE(this.device),print("USER_AGENT:",this.user_agent),this.phone_id=generate_uuid(),print("PHONE_ID (just another uuid):",this.phone_id),this.uuid=generate_uuid(),print("UUID:",this.uuid),this.rank_token=()=>`${this.user_id}_${this.uuid}`,this.username=e,this.password=t,this.total_requests=0,this.last_response={},this.methods=methods,this.constants={DEVICE:this.device,LOCALE:this.locale,IG_SIG_KEY:IG_SIG_KEY}}async default_data(){return{_uuid:this.uuid,_uid:this.user_id}}async login_via_cookie(){if(this.is_logged_in)throw new Error("Already logged in");console.log("login via cookie");const{viewer:e}=await this.send_request("direct_v2/inbox/?",null,{doLogin:!0}),t=e.pk,{user:r,status:n}=await this.send_request(`users/${t}/info/`,null,{doLogin:!0});console.log("logged_in",r),this.history&&this.history.save("login",[r.username,"__from_cookie__"],{status:n});try{if(r)return this.is_logged_in=!0,this.user_id=r.pk,this.user=r,r;throw new Error(`Could not log in: ${response}`)}catch(e){throw console.error(`LoginError: ${e.message}`),e}}async login(e,t,r=!1){if(this.is_logged_in&&!r)throw new Error("Already logged in");const n=e||this.username,o=t||this.password;try{const{logged_in_user:e,status:t}=await this._login(n,o),r=o.split("").fill("*").join("");if(this.history&&this.history.save("login",[n,r],{status:t}),e)return this.is_logged_in=!0,this.user_id=e.pk,this.user=e,e;throw new Error(`Could not log in: ${response}`)}catch(e){throw console.error(`LoginError: ${e.message}`),e}}async verify_2fa(e,t,r,n){const o=n.two_factor_info.two_factor_identifier;if(!this.device_id)return console.error("this.device_id uninitialized! You need to call .login first"),!1;const s={device_id:this.device_id,username:e,password:t,verification_code:r,two_factor_identifier:o,ig_sig_key_version:4};try{const{logged_in_user:r,status:n}=await this.send_request("accounts/two_factor_login/",s,{doLogin:!0}),o=t.split("").fill("*").join("");if(this.history&&this.history.save("login",[e,o],{status:n}),r)return this.is_logged_in=!0,this.user_id=r.pk,this.user=r,r;throw new Error(`Could not log in: ${response}`)}catch(e){throw console.error(`LoginError: ${e.message}`),e}}async _login(e,t){this.device_id=generate_device_id_from_username(e),print("DEVICE_ID:",this.device_id);const r=JSON.stringify({phone_id:this.phone_id,username:e,guid:this.uuid,device_id:this.device_id,password:t,login_attempt_count:"0"});print("Final POST DATA before signing:\n",r);const n=generate_signature(r);print("Final POST DATA after signing:\n",n);const o=await this.send_request("accounts/login/",r,{doLogin:!0});return"checkpoint_required"==o.message&&console.log("Checkpoing required:",o.checkpoint_url),o}async _request(e,t="GET",r,n={},{v2:o=!1,form:s=!1}={}){const i=prefixUnsecureHeaders({"User-Agent":this.user_agent,...REQUEST_HEADERS,...n},"replace");if(s){const e=new FormData;Object.keys(r).forEach(t=>{e.set(t,r[t])}),r=e}const a=o?API_URL_v2:API_URL,u=await axios$1({url:a+e,method:t,data:r,headers:i}),{data:c,status:l}=u;if(200==l)return this.last_response=u,c;if(console.error(`Request returns error! Status: ${l}`),c.message.includes("feedback_required"))throw console.error("ATTENTION! 'feedback_required', your action could have been blocked"),new Error("feedback_required");if(429===l){const e=5;console.error(`That means 'too many requests'. I'll go to sleep\n        for ${e} minutes`),await sleep(3e5)}else if(400===l){const e=c.message,t=c.error_type;throw console.log(`Instagram's error message: ${e}, Error type: ${t}`),new Error(`InstagramError: ${t}: ${e}`)}return!1}_get(e,t={},r={}){return this._request(e,"GET",null,t,r)}_post(e,t,r={},n={}){return this._request(e,"POST",t,r,n)}async send_request(e,t=null,{doLogin:r=!1,with_signature:n=!0,...o}={}){if(!this.is_logged_in&&!r)throw new Error(`Not logged in! Tried to call ${e}`);this.user_id||r||console.warn("'user_id' is undefined! Endpoints that need rank_token will not work. Try to relogin.");const s=n?generate_signature(t):t;try{return t?await this._post(e,s,{},{...o}):await this._get(e,{},{...o})}catch(r){throw console.error("Request failed:",r,"Data:",e,t),r}}async callMethod(e,...t){const r=methods[e];if("function"!=typeof r)throw new Error(`No method: ${e}. Available methods: ${Object.keys(methods).join()}`);if(this.confirmator){if(!await this.confirmator.confirm(`${e} ${t.join(" ")}?`))throw new Error("User rejected request")}const n=await r(this,...t);return this.history&&this.history.save(e,t,n),n}}const AVAILABLE_METHODS=Object.keys(methods);class History{static get AVAILABLE_METHODS(){return AVAILABLE_METHODS}save(e,t,r){return console.log(e,t,r),{}}get(...e){return{}}}window.Instagram=Instagram,window.History=History;const instagram=new Instagram;class ChromeStorage{static set(e,t){return new Promise((r,n)=>{setTimeout(()=>n("Storage Error: Cant save"),1e3),chrome.storage.local.set({[e]:t},()=>{r(t)})})}static get(...e){return new Promise((t,r)=>{setTimeout(()=>r("Storage Error: Cant fetch"),1e3),chrome.storage.local.get(e,e=>{t(e)})})}static async append(e,t){const{[e]:r}=await ChromeStorage.get(e),n=[...r||[],t];return ChromeStorage.set(e,n)}}class Collection{get default_key(){return"misc"}constructor(e,t){this.name=e||"collection",this.available_keys=t}async save(e,t){const r=Date.now();this.available_keys.includes(e)||(e=this.default_key);const n={savedAt:r,...t};return ChromeStorage.append(`${this.name}.${e}`,n)}async set(e,t){const r=Date.now();this.available_keys.includes(e)||(e=this.default_key);const n={savedAt:r,...t};return ChromeStorage.set(`${this.name}.${e}`,n)}async get(...e){const t=(e=e.length?e:this.available_keys).map(e=>`${this.name}.${e}`),r=await ChromeStorage.get(...t);return e.reduce((e,t)=>({...e,[t]:r[`${this.name}.${t}`]||[]}),{})}}class ChromeHistory extends History{constructor(){super(),this.collection=new Collection("history",[...History.AVAILABLE_METHODS,"login","misc"])}async save(e,t,r){const{status:n}=r,o={params:t,status:n};return this.collection.save(e,o)}async get(...e){return this.collection.get(...e)}}class InstagramStats extends Collection{constructor(e){super(),this.available_keys=["follower_count","following_count","average_like_count","user","current","misc"],this.instagram=e}async updateValues(){if(!instagram.is_logged_in)throw new Error("Instagram not logged in");const{user:e}=await this.instagram.callMethod("get_user_info",this.instagram.user.pk),{items:t}=await this.instagram.callMethod("get_user_feed",this.instagram.user.pk),r=t.length?t.reduce((e,t)=>e+t.like_count,0)/t.length:0;return e.average_like_count=Math.floor(r),await this.save("user",e),await this.set("current",e),await this.save("follower_count",{followers:e.follower_count,pk:e.pk}),await this.save("following_count",{followers:e.following_count,pk:e.pk}),await this.save("average_like_count",{likes:e.average_like_count,pk:e.pk}),e}async getInfo(){const{like:e}=await this.instagram.history.get("like"),{follow:t}=await this.instagram.history.get("follow"),{follower_count:r}=await this.get("follower_count"),{following_count:n}=await this.get("following_count"),{average_like_count:o}=await this.get("average_like_count"),{current:s}=await this.get("current");return{likes:e.length,follows:t.length,follower_count:s.follower_count,following_count:s.following_count,average_like_count:s.average_like_count,full:{current:s,like:e,follow:t,follower_count:r,following_count:n,average_like_count:o}}}}const stats=new InstagramStats(instagram),saveCredentials=(e,t)=>new Promise((r,n)=>{chrome.storage.local.set({credentials:{username:e,password:t}},()=>{r({username:e,password:t})}),setTimeout(()=>n("storage error"),5e3)}),getCredentials$1=()=>new Promise((e,t)=>{chrome.storage.local.get(["credentials"],t=>{e(t.credentials||{})}),setTimeout(()=>t("storage error"),5e3)});window.saveCredentials=saveCredentials,window.getCredentials=getCredentials$1;var name="GramUp! – Free Social Bot",short_name="GramUp! Bot",version$1="1.5.4",description="Extension helps you effectively use social networks!",icons={192:"images/icon.png"},background={scripts:["build/background.js"]},browser_action={default_popup:"popup.html",default_icon:"images/icon.png"},permissions=["storage","background","notifications","webRequest","webRequestBlocking","https://i.instagram.com/"],externally_connectable={matches:["http://localhost/","https://dashboard.gramup.me/","https://dm.gramup.me/","https://*.okhlopkov.now.sh/","https://*.caffeinum.now.sh/"]},manifest_version=2,manifest={name:name,short_name:short_name,version:version$1,description:description,icons:icons,background:background,browser_action:browser_action,permissions:permissions,externally_connectable:externally_connectable,manifest_version:manifest_version};const GRAMUP_REMOTE_CONFIG_URL="https://dashboard.gramup.me/config.json",VERSION=manifest.version,USER_AGENT=navigator?navigator.userAgent:"none",GRAMUP_DEFAULT_WS_URL="wss://gate.likeup.me/",DEFAULT_LOCAL_CONFIG={familyUrl:GRAMUP_DEFAULT_WS_URL},DEFAULT_CONFIG={JOINED_FAMILY:!0,NOT_BETA_TEST:!0,CURRENT_TASK:null};var constants=Object.freeze({__proto__:null,GRAMUP_REMOTE_CONFIG_URL:GRAMUP_REMOTE_CONFIG_URL,VERSION:VERSION,USER_AGENT:USER_AGENT,GRAMUP_DEFAULT_WS_URL:GRAMUP_DEFAULT_WS_URL,DEFAULT_LOCAL_CONFIG:DEFAULT_LOCAL_CONFIG,DEFAULT_CONFIG:DEFAULT_CONFIG});const processMessage=async(e,t,r,n)=>{try{const{method:o,params:s=[]}=r;if("ping"===o)return n({status:"ok",pong:"pong"});if("version"===o||"info"===o)return n({status:"ok",version:VERSION,user_agent:USER_AGENT,device:{user_agent:e.user_agent,phone_id:e.phone_id,uuid:e.uuid},constants:e.constants,config:t});if("stats"===o){return await stats.updateValues(),n({status:"ok",data:await stats.getInfo()})}if("config"===o){const{config:r=DEFAULT_LOCAL_CONFIG}=await ChromeStorage.get("config")||{},[o]=s;try{await ChromeStorage.set("config",{...r,...o});const{config:s}=await ChromeStorage.get("config");return updateWSData(e,t=s),n({status:"ok",config:s})}catch(e){return n({status:"error",error:e.message})}}if("login"===o){const[r,o]=s;try{const s=await e.login(r,o,!0);return updateWSData(e,t),n({status:"ok",user:s})}catch(e){console.error(e);const{message:t,response:r}=e,{data:o,headers:s}=r;return n({status:"error",error:{message:t,response:o,headers:s}})}}if("login_via_cookie"===o)try{const r=await e.login_via_cookie();return updateWSData(e,t),n({status:"ok",user:r})}catch(e){console.error(e);const{message:t,response:r}=e,{data:o,headers:s}=r;return n({status:"error",error:{message:t,response:o,headers:s}})}if("login_2fa"===o){const[t,r,o,i]=s;try{return n({status:"ok",user:await e.verify_2fa(t,r,o,i)})}catch(e){console.error(e);const{message:t,response:r}=e,{data:o,headers:s}=r;return n({status:"error",error:{message:t,response:o,headers:s}})}}if("exit"===o)return e.user={},e.is_logged_in=!1,n({status:"ok",user:e.user});if("check_login"===o){try{if(e.user&&e.user.username){const t=await e.callMethod("get_user_info",e.user.username);e.user=t.user}}catch(t){console.log("Needs relogin",t);const{username:r,password:n}=await getCredentials$1();e.user=r?await e.login(r,n,!0):await e.login_via_cookie()}return n({status:"ok",user:e.user})}return n(e?await e.callMethod(o,...s):{status:"error",error:{message:"Not initialized"}})}catch(e){console.error(e);const{message:t,response:r}=e,{data:o,headers:s}=r||{};return n({status:"error",error:{message:t,response:o,headers:s}})}},{GRAMUP_REMOTE_CONFIG_URL:GRAMUP_REMOTE_CONFIG_URL$1,GRAMUP_DEFAULT_WS_URL:GRAMUP_DEFAULT_WS_URL$1}=constants,{DEFAULT_CONFIG:DEFAULT_CONFIG$1}=constants,getRemoteConfig=()=>fetch(GRAMUP_REMOTE_CONFIG_URL$1).then(e=>e.json()).then(e=>e||DEFAULT_CONFIG$1).catch(e=>(console.error(e),DEFAULT_CONFIG$1));window.connection=null;const connectWebsocket=async(e,t,r=1)=>{if(window.connection&&window.connection.readyState===window.connection.OPEN)return console.log("Already running...");const{familyUrl:n}=await getRemoteConfig(),o=new WebSocket(n),s=e=>o.send(JSON.stringify(e));return window.connection=o,o.onerror=e=>{console.error(e),o.close()},o.onopen=()=>{r=1,console.log("Connected to FAMILY",n),updateWSData(e,t)},o.onclose=()=>{console.log("Connection to FAMILY closed"),console.log(`Reconnecting to FAMILY in ${r} seconds...`),setTimeout(()=>connectWebsocket(e,t,2*r),1e3*r)},o.onmessage=async r=>{console.log("event",r);try{const n=JSON.parse(r.data);if(console.log("message",n),console.log("sender",r.origin),!n.method)throw new Error(`Wrong message format: '${r.data}', 'method' expected`);if(!t.JOINED_FAMILY&&t.NOT_BETA_TEST)throw console.log(`Drop action, JOINED_FAMILY = ${t.JOINED_FAMILY}, BETA_TEST = ${!t.NOT_BETA_TEST}`),new Error(`FAMILY turned off: JOINED_FAMILY = ${t.JOINED_FAMILY}, BETA_TEST = ${!t.NOT_BETA_TEST}`);await processMessage(e,t,n,s)}catch(e){console.error(e,r),s({status:"error",error:{message:e.message}})}},{connection:o,sendResponse:s}},updateWSData=async(e,t)=>{try{if(e.user){const{user:t}=await e.callMethod("get_user_info",e.user.pk);e.user=t}window.connection.send(JSON.stringify({status:"ok",version:VERSION,user_agent:USER_AGENT,user:e.user,device:{user_agent:e.user_agent,phone_id:e.phone_id,uuid:e.uuid},constants:e.constants,config:t}))}catch(e){console.error("Error updating WS data",e)}};window.instagram=instagram,window.instagram.history=new ChromeHistory,window.stats=stats,document.addEventListener("DOMContentLoaded",async()=>{const{username:e,password:t}=await getCredentials$1(),{config:r=DEFAULT_LOCAL_CONFIG}=await ChromeStorage.get("config")||{};if(e&&t){const r=await instagram.login(e,t);console.log("user",r)}else{console.log("No credentials!");const e=await instagram.login_via_cookie();console.log("user",e)}chrome.runtime.onConnectExternal.addListener(async e=>{console.log("connect",e),e.onMessage.addListener(async(t,n)=>{console.log("message",t),console.log("sender",n);const{req_id:o}=t;await processMessage(instagram,r,t,t=>e.postMessage({req_id:o,...t}))})}),chrome.runtime.onMessageExternal.addListener(async(e,t,n)=>{console.log("message",e),console.log("sender",t),await processMessage(instagram,r,e,n)}),chrome.runtime.onMessage.addListener(async(e,t)=>{console.log("message",e),console.log("sender",t);const{req_id:n}=e;await processMessage(instagram,r,e,e=>((e,t,r)=>(console.log("reply to",t,r),e.tab?chrome.tabs.sendMessage(e.tab.id,{req_id:t,...r}):chrome.runtime.sendMessage(e.id,{req_id:t,...r})))(t,n,e))});const{connection:n}=await connectWebsocket(instagram,r);window.connection=n},!1)}));
//# sourceMappingURL=background.js.map
